#!/bin/sh

while true ; do
  NETWORK=ðŸ“¶

  if systemctl status openvpn-toronto.service | grep 'Active: active' > /dev/null ; then
    NETWORK_COLOUR='darkred'
    NETWORK="$NETWORK ðŸ•µï¸"
  else
    NETWORK_COLOUR='indigo'
  fi

  NETWORK="$NETWORK `nmcli -t -f GENERAL.CONNECTION device show wlp2s0 | cut -d : -f 2-`"
  NETWORK="$NETWORK (`nmcli -t -f IP4.ADDRESS device show wlp2s0 | grep -o '\([0-9]\+\.\)\{3\}[0-9]\+'`)"

  VOLUME=`pactl list sinks | grep '	Volume:' | grep -o '[0-9]\+%' | cut -d % -f 1 | head -n 1`

  if pactl list sinks | grep 'Active Port: analog-output-headphones' > /dev/null ; then
    AUDIO=ðŸŽ§

    if pactl list sinks | grep 'Mute: yes' > /dev/null ; then
      AUDIO="$AUDIO ðŸ”‡"
    fi

  elif pactl list sinks | grep 'Mute: yes' > /dev/null ; then
    AUDIO=ðŸ”‡
  elif [[ $VOLUME -le 0 ]] ; then
    AUDIO=ðŸ”ˆ
  elif [[ $VOLUME -lt 50 ]] ; then
    AUDIO=ðŸ”‰
  else
    AUDIO=ðŸ”Š
  fi

  AUDIO="$AUDIO $VOLUME%"

  if [[ `cat /sys/class/power_supply/BAT0/status` = Discharging ]] ; then
    POWER=ðŸ”‹
  else
    POWER=ðŸ”Œ
  fi

  POWER="$POWER `cat /sys/class/power_supply/BAT0/capacity`%"

  DATE=`date '+%a %b %d %Y %-I:%M:%S %p'`

  echo \
    "<span background=\"$NETWORK_COLOUR\"> $NETWORK </span>" \
    "<span background=\"darkblue\"> $AUDIO </span>" \
    "<span background=\"darkgreen\"> $POWER </span>" \
    "<span> $DATE </span>"

  sleep 1
done
